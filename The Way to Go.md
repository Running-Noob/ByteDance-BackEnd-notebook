# The Way to Go

- 鉴于字节跳动训练营中关于 `Go` 语言方面的介绍过于简洁凝练，所以额外阅读了 [《The Way to Go》即《Go 入门指南》](https://github.com/unknwon/the-way-to-go_ZH_CN) ，并做以下笔记，来帮助自己对 `Go` 有一个更清晰的认识。
- 注意：本笔记仅记录我认为有必要记录的地方，如果想知道全部细节，请阅读上面提到的 `《Go入门指南》` 。

## 02 安装与运行环境

### 2.2 Go环境变量

- Go 开发环境依赖于一些操作系统环境变量，你最好在安装 Go 之前就已经设置好他们。如果你使用的是 Windows 的话，你完全不用进行手动设置，Go 将被默认安装在目录 `c:/go` 下。这里列举几个最为重要的环境变量：

  - **$GOROOT** 表示 Go 在你的电脑上的安装位置，它的值一般都是 `$HOME/go`，当然，你也可以安装在别的地方。
  - **$GOARCH** 表示目标机器的处理器架构，它的值可以是 386、amd64 或 arm。
  - **$GOOS** 表示目标机器的操作系统，它的值可以是 darwin、freebsd、linux 或 windows。
  - **$GOBIN** 表示编译器和链接器的安装位置，默认是 `$GOROOT/bin`，如果你使用的是 Go 1.0.3 及以后的版本，一般情况下你可以将它的值设置为空，Go 将会使用前面提到的默认值。

  目标机器是指你打算运行你的 Go 应用程序的机器。

  - **$GOPATH** 默认采用和 `$GOROOT` 一样的值，但从 Go 1.1 版本开始，你必须修改为其它路径。它可以包含多个 Go 语言源码文件、包文件和可执行文件的路径，而这些路径下又必须分别包含三个规定的目录：`src`、`pkg` 和 `bin`，这三个目录分别用于存放源码文件、包文件和可执行文件。
  - **$GOARM** 专门针对基于 arm 架构的处理器，它的值可以是 5 或 6，默认为 6。
  - **$GOMAXPROCS** 用于设置应用程序可使用的处理器个数与核数。

### 2.7 Go运行时runtime

- 尽管 Go 编译器产生的是本地可执行代码，这些代码仍旧运行在 Go 的 runtime（这部分的代码可以在 `runtime` 包中找到）当中。这个 runtime 类似 Java 和 .NET 语言所用到的虚拟机，它负责管理包括内存分配、垃圾回收（[第 10.8 节](https://github.com/unknwon/the-way-to-go_ZH_CN/blob/master/eBook/10.8.md)）、栈处理、goroutine、channel、切片 (slice)、map 和反射 (reflection) 等等。

## 03 编辑器、集成开发环境与其它工具

### 3.2 编辑器和集成开发环境

- 这些编辑器包含了代码高亮和其它与 Go 有关的一些使用工具：Emacs、Vim、Xcode 6、KD Kate、TextWrangler、BBEdit、McEdit、TextMate、TextPad、JEdit、SciTE、Nano、Notepad++、Geany、SlickEdit、**Visual Studio Code**、IntelliJ IDEA 和 Sublime Text 2。
- **代码补全** 一般都是通过内置 GoCode 实现的（如：LieteIDE、GoClipse），如果需要手动安装 GoCode，在命令行输入指令 `go get -u github.com/nsf/gocode` 即可（务必事先配置好 Go 环境变量） 。

### 3.4 构建并运行 Go 程序

- 在大多数 IDE 中，每次构建程序之前都会自动调用源码格式化工具 `gofmt` 并保存格式化后的源文件。如果构建成功则不会输出任何信息，而当发生编译时错误时，则会指明源码中具体第几行出现了什么错误，如：`a declared and not used`。一般情况下，你可以双击 IDE 中的错误信息直接跳转到发生错误的那一行。

  如果程序执行一切顺利并成功退出后，将会在控制台输出 `Program exited with code 0`。

  从 Go 1 版本开始，使用 Go 自带的更加方便的工具来构建应用程序：

  - `go build` 编译自身包和依赖包
  - `go install` 编译并安装自身包和依赖包

### ★3.5 格式化代码

- Go 开发团队不想要 Go 语言像许多其它语言那样总是在为代码风格而引发无休止的争论，浪费大量宝贵的开发时间，因此他们制作了一个工具：`go fmt` (gofmt)。这个工具可以将你的源代码格式化成符合官方统一标准的风格，属于语法风格层面上的小型重构。遵循统一的代码风格是 Go 开发中无可撼动的铁律，因此你必须在编译或提交版本管理系统之前使用 gofmt 来格式化你的代码。

  尽管这种做法也存在一些争论，但使用 gofmt 后你不再需要自成一套代码风格而是和所有人使用相同的规则。这不仅增强了代码的可读性，而且在接手外部 Go 项目时，可以更快地了解其代码的含义。此外，大多数开发工具也都内置了这一功能。

  Go 对于代码的缩进层级方面使用 tab 还是空格并没有强制规定，一个 tab 可以代表 4 个或 8 个空格。在实际开发中，1 个 tab 应该代表 4 个空格，而在本身的例子当中，每个 tab 代表 8 个空格。至于开发工具方面，一般都是直接使用 tab 而不替换成空格。

  **在命令行输入 `gofmt –w program.go` 会格式化该源文件的代码然后将格式化后的代码覆盖原始内容（如果不加参数 `-w` 则只会打印格式化后的结果而不重写文件）**；`gofmt -w *.go` 会格式化并重写所有 Go 源文件；`gofmt map1` 会格式化并重写 `map1` 目录及其子目录下的所有 Go 源文件。

  `gofmt` 也可以通过在参数 `-r` 后面加入用双引号括起来的替换规则实现代码的简单重构，规则的格式：`<原始内容> -> <替换内容>`。

  实例：

  ```shell
  gofmt -r '(a) -> a' –w *.go
  ```

  上面的代码会将源文件中没有意义的括号去掉。

  ```shell
  gofmt -r 'a[n:len(a)] -> a[n:]' –w *.go
  ```

  上面的代码会将源文件中多余的 `len(a)` 去掉。（ **译者注：了解切片 (slice) 之后就明白这为什么是多余的了** ）

  ```shell
  gofmt –r 'A.Func1(a,b) -> A.Func2(b,a)' –w *.go
  ```

  上面的代码会将源文件中符合条件的函数的参数调换位置。